$domain=([ADSI]"LDAP://RootDSE").rootDomainNamingContext;(([adsi]"LDAP://$domain"),(([adsisearcher]'(objectcategory=organizationalunit)')).findall()).Path | %{if(([ADSI]"$_").gPlink){Write-Host "[+] OU Path:"([ADSI]"$_").Path;$a=((([ADSI]"$_").gplink) -replace "[[;]" -split "]");for($i=$a.length;$i -ge 0;$i--){if($a[$i]){Write-Host "Policy Path[$i]:"($a[$i]).Substring(0,$a[$i].length-1);$status=$a[$i].Substring($a[$i].length-1,1);$b=([ADSI]($a[$i]).Substring(0,$a[$i].length-1)).DisplayName;if($b){Write-Host "Policy Name[$i]:"$b}else{Write-Host "Policy Name[$i]: HIDDEN POLICY!!!"} switch($status) {"0" {"Linked[$i]: True";Write-Host "Enforced[$i]: False"} "1" {"Linked[$i]: False";Write-Host "Enforced[$i]: False"} "2" {"Linked[$i]: True";Write-Host "Enforced[$i]: True"} "3" {"Linked[$i]: False";Write-Host "Enforced[$i]: True"} };if(([ADSI]"$_").gPOptions){Write-Host "BlockInheritance[$i]: True"}else{"BlockInheritance[$i]: False"} Write-Output "`n" }};Write-Output "`n"}}
